<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Annex 4B - PSV Safety Inspection Record (Final)</title>

<style>
  :root{ --accent:#0b66d1; --bg:#071533; --muted:#6b7280; }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: "Segoe UI", Roboto, Arial, sans-serif;
    background: linear-gradient(180deg,var(--bg) 0%, #08254a 60%);
    color:#e6eefc; padding:18px;
  }
  header{ display:flex; gap:18px; justify-content:center; align-items:center; padding:12px 0; margin-bottom:8px; }
  header img{ max-height:56px; object-fit:contain; display:block; }
  .container{ max-width:1200px; margin:0 auto; }
  .page{
    background:#ffffff; color:#0b1b33; padding:20px; border-radius:6px;
    box-shadow:0 10px 30px rgba(2,10,35,0.45);
  }
  h1{ text-align:center; margin:4px 0 12px; color:#0b2350; font-size:18px; }
  .job-number{ text-align:center; margin-bottom:14px; color:#0b2350; font-weight:700 }
  .section-title{ color:var(--accent); font-size:14px; margin:6px 0 10px; }
  table{ width:100%; border-collapse:collapse; font-size:12px; margin-bottom:10px; }
  th, td{ border:1px solid #dfe9f8; padding:6px; vertical-align:middle; }
  th{ background:#f5f9ff; color:#0b2350; font-weight:600; text-align:left }

  /* Inputs aligned middle for PDF capture - FONT SIZE DECREASED AND ALIGNMENT FIXED */
  input[type="text"], input[type="date"], select {
    width:100%; height:30px; line-height:30px;
    padding:0 6px; border-radius:4px; border:1px solid #d6e6fc;
    font-size:10px; /* Reduced font size for better fit */
    vertical-align:middle;
  }
  /* Specific padding adjustment for text inputs within tables for better vertical alignment */
  .page table input[type="text"], .page table select {
    padding: 0 4px;
    line-height: 28px; /* Adjusted line-height to center 10px font */
  }

  textarea {
    width:100%; min-height:100px; resize:vertical;
    padding:8px; line-height:1.4; border:1px solid #d6e6fc; border-radius:4px;
    font-size:12px; vertical-align:middle;
  }

  .small{ color:var(--muted); font-size:12px }
  .btn{ background:var(--accent); color:#fff; border:0; padding:10px 16px; border-radius:6px; cursor:pointer; font-weight:700; display:block; margin:18px auto 40px; }
  .key{ display:flex; gap:12px; align-items:center; margin-bottom:8px; flex-wrap:wrap }
  .key-item{ display:flex; gap:6px; align-items:center; font-size:13px }
  .key-swatch{ width:18px; height:18px; border-radius:4px; border:1px solid rgba(0,0,0,0.08) }
  .muted-note{ color:#667085; font-size:11px; margin-top:6px }
  @media (max-width:980px){ header img{ max-height:48px } }

  /* --- Two-column layout restored for inspection parts --- */
  .two-column-layout {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
  }
  .two-column-layout table {
    flex: 1; /* Makes both tables take equal width */
    margin-bottom: 0;
  }
  /* Ensure the table columns within the two-column layout are appropriately sized */
  .two-column-layout th:nth-child(1), .two-column-layout td:nth-child(1) { width: 8%; }
  .two-column-layout th:nth-child(2), .two-column-layout td:nth-child(2) { width: 12%; }
  .two-column-layout th:nth-child(4), .two-column-layout td:nth-child(4) { width: 15%; }

  @media (max-width: 768px) {
    /* Stack columns on small screens if necessary */
    .two-column-layout { flex-direction: column; }
  }
  .italic-select { font-style: italic; }
  /* Custom CSS to force page break for PDF/Print compatibility */
  .pdf-page-break { page-break-before: always; height: 265px; }
</style>
</head>
<body>
  <header>
    <img id="logoLeft" src="https://www.gtt-online.co.uk/media/2193/logo.png" alt="GTT logo">
    <img id="logoRight" src="https://westnorfolkct.co.uk/wp-content/uploads/2025/01/WNCTP-Logo.png" alt="WNCT logo">
  </header>

  <div class="container">
    <div class="page" id="formPage">
      <h1>Annex 4B — Safety Inspection Record (PSV)</h1>
      <div class="job-number">Job Number: <span id="jobNumber"></span></div>

      <div class="section-title">Vehicle Details</div>
      <table>
        <tbody>
          <tr>
            <td style="width:18%"><strong>Vehicle Reg Mark</strong></td>
            <td>
              <select id="reg_mark">
                <option value="" data-make="" data-vin="">-- Select Reg Mark --</option>
                </select>
            </td>
            <td style="width:18%"><strong>Odometer Reading</strong></td>
            <td><input id="odometer" type="text"></td>
          </tr>
          <tr>
            <td><strong>Make & Model Type</strong></td>
            <td><input id="make_model" type="text" readonly></td>
            <td><strong>VIN</strong></td>
            <td><input id="vin" type="text" readonly></td>
          </tr>
          <tr>
            <td><strong>Date of Inspection</strong></td>
            <td><input id="inspection_date" type="date"></td>
            <td><strong>ISO Week No.</strong></td>
            <td><input id="iso_week" type="text" readonly></td>
          </tr>
          <tr>
            <td><strong>Inspection Organisation</strong></td>
            <td><input id="organisation" type="text" value="West Norfolk Community Transport"></td>
            <td><strong>Operator</strong></td>
            <td><input id="operator" type="text" value="West Norfolk Community Transport"></td>
          </tr>
          <tr>
            <td><strong>Location of Inspection</strong></td>
            <td colspan="3"><input id="location" type="text" value="Unit 7 & 8, Merchants Close, King’s Lynn, Norfolk, PE30 4JX"></td>
          </tr>
        </tbody>
      </table>

      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="section-title">Part 1A — Inside Vehicle</div>
        <div class="small">Key:</div>
      </div>
      <div class="key" style="margin-bottom:12px">
        <div class="key-item"><div class="key-swatch" style="background:#6ee77a"></div>✓ Satisfactory</div>
        <div class="key-item"><div class="key-swatch" style="background:#ff7b7b"></div>× Safety Item Defect</div>
        <div class="key-item"><div class="key-swatch" style="background:#9fd8ff"></div>R Repair Required</div>
        <div class="key-item"><div class="key-swatch" style="background:#cbd5e1"></div>N/A Not Applicable</div>
        <div class="key-item"><div class="key-swatch" style="background:#ffb86b"></div>M Monitor</div>
      </div>

      <div class="two-column-layout" id="tablePart1A_wrapper">
        <table id="tablePart1A_col1">
          <thead>
            <tr><th>Chk</th><th>IM Ref</th><th>Item Inspected</th><th>Serviceable</th></tr>
          </thead>
          <tbody>
            <tr data-check="1"><td>1</td><td>18</td><td>Driver’s Seat</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="2"><td>2</td><td>3</td><td>Seat Belts and Supplementary Restraint Systems</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="3"><td>3</td><td>22</td><td>Mirrors and Indirect Vision Devices</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="4"><td>4</td><td>23</td><td>Glass and View of the Road</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="5"><td>5</td><td>24</td><td>Accessibility Features</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="6"><td>6</td><td>25</td><td>Windscreen Washers and Wipers</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="7"><td>7</td><td>26</td><td>Speedometer / Tachograph</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="8"><td>8</td><td>27</td><td>Horn</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="9"><td>9</td><td>28</td><td>Driving Controls / Warning Lamps (inc ADAS)</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>
          </tbody>
        </table>

        <table id="tablePart1A_col2">
          <thead>
            <tr><th>Chk</th><th>IM Ref</th><th>Item Inspected</th><th>Serviceable</th></tr>
          </thead>
          <tbody>
            <tr data-check="10"><td>10</td><td>30</td><td>Steering Control</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="11"><td>11</td><td>37</td><td>Service Brake Pedal</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="12"><td>12</td><td>38</td><td>Service Brake Operation (inc ABS/EBS & ESC)</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="13"><td>13</td><td>34</td><td>Pressure / Vacuum Warning and Build Up</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="14"><td>14</td><td>36</td><td>Hand Lever Operating Mechanical Park Brakes and Electronic Park Brake Control</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="15"><td>15</td><td>39</td><td>Hand Operated Brake Control Valves</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="16"><td>16</td><td>17</td><td>Driver’s Accommodation</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="17"><td>17</td><td>21</td><td>Interior of Body, Passenger Entrance, Exit Steps and Platforms</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="18"><td>18</td><td>OBD</td><td>Diagnostic trouble code (DTC) check</td>
              <td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>
          </tbody>
        </table>
      </div>

      <div class="section-title">Part 1B — Ground level & under vehicle</div>
      <div class="two-column-layout" id="tablePart1B_wrapper">
        <table id="tablePart1B_col1">
          <thead><tr><th>Chk</th><th>IM Ref</th><th>Item Inspected</th><th>Serviceable</th></tr></thead>
          <tbody>
            <tr data-check="B1"><td>1</td><td>1</td><td>Registration Plates</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B2"><td>2</td><td>16</td><td>Passenger Doors, Driver’s Doors & Emergency Exits</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B3"><td>3</td><td>19</td><td>Security of Body</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B4"><td>4</td><td>20</td><td>Exterior of Body including Luggage Compartments</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B5"><td>5</td><td>5</td><td>Exhaust Emissions / MIL</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B6"><td>6</td><td>6</td><td>Road Wheels and Hubs</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B7"><td>7</td><td>7</td><td>Size and Type of Tyres</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B8"><td>8</td><td>8</td><td>Condition of Tyres (including age and date code)</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B9"><td>9</td><td>9</td><td>Bumper Bars</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B10"><td>10</td><td>10</td><td>Spare Wheel and Carrier</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B11"><td>11</td><td>14</td><td>Wings & Wheel Arches</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B12"><td>12</td><td>11</td><td>Vehicle to Trailer Coupling</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B13"><td>13</td><td>41</td><td>Condition of Chassis</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B14"><td>14</td><td>33</td><td>Speed Limiter</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B15"><td>15</td><td>42</td><td>Electrical Wiring and Equipment</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B16"><td>16</td><td>43</td><td>Engine and Transmission Mountings</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>
          </tbody>
        </table>

        <table id="tablePart1B_col2">
          <thead><tr><th>Chk</th><th>IM Ref</th><th>Item Inspected</th><th>Serviceable</th></tr></thead>
          <tbody>
            <tr data-check="B17"><td>17</td><td>44</td><td>Oil and Waste Leaks</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B18"><td>18</td><td>45</td><td>Fuel Tanks and System</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B19"><td>19</td><td>46</td><td>Exhaust Systems and Nuisance</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B20"><td>20</td><td>54</td><td>Steering</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B21"><td>21</td><td>48</td><td>Suspension</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B22"><td>22</td><td>53</td><td>Axles, Stub Axles and Wheel Bearings</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B23"><td>23</td><td>57</td><td>Transmission</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B24"><td>24</td><td>58</td><td>Additional Braking Devices</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B25"><td>25</td><td>59</td><td>Brake Systems and Components</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B26"><td>26</td><td>62</td><td>Reflectors and Rear Markings</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B27"><td>27</td><td>63</td><td>Lamps</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B28"><td>28</td><td>66</td><td>Direction Indicators & Hazard Warning Lamps</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B29"><td>29</td><td>67</td><td>Aim of Headlamps</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B30"><td>30</td><td>74</td><td>Other dangerous defects (ancillary equipment)</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="R">R</option><option value="M">M</option><option value="N/A">N/A</option></select></td></tr>

            <tr data-check="B31"><td>31</td><td>-</td><td>Safety recall check</td><td><select class="serviceable"><option value="✓">✓</option><option value="×">×</option><option value="N/A">N/A</option></select></td></tr>
          </tbody>
        </table>
      </div>

      <div class="pdf-page-break"></div>
      
      <div class="section-title">IM8 — Condition of tyres as presented</div>
      <p class="small">Enter tread depth (mm) and pressure (psi). Put N/A if not applicable</p>
      <table id="im8">
        <thead><tr><th>Check No</th><th>Axle</th><th>O/S Out</th><th>O/S In</th><th>N/S In</th><th>N/S Out</th></tr></thead>
        <tbody>
          <tr><td>51</td><td>Axle 1</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
          <tr><td>51</td><td>Axle 2</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
          <tr><td>51</td><td>Axle 3</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
          <tr><td>51</td><td>Axle 4</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
        </tbody>
      </table>

      <div class="section-title">C — Braking performance assessment</div>
      <table>
        <tbody>
          <tr><td style="width:22%"><strong>Date of assessment</strong></td><td><input id="brake_date" type="date"></td></tr>
          <tr><td><strong>Laden / Unladen (weight)</strong></td><td><input id="laden_status" type="text" placeholder="e.g. laden 10000kg / unladen"></td></tr>
          <tr><td><strong>Test type</strong></td><td><select id="test_type"><option value="">-- Select --</option><option value="Roller Brake Test (RBT)">Roller Brake Test (RBT)</option><option value="Decelerometer">Decelerometer</option><option value="EBPMS">EBPMS</option></select></td></tr>
          <tr><td><strong>RBT printout attached</strong></td><td><label><input id="rbt_attached" type="checkbox"> Yes</label></td></tr>
        </tbody>
      </table>

      <div class="section-title">D — Brake temperature assessment</div>
      <div style="margin-bottom:8px"><label class="small">Ambient air temperature (°C)</label><input id="ambient_temp" type="text" placeholder="e.g. 12"></div>

      <table>
        <thead><tr><th>Chk No</th><th>IM Ref</th><th>Item Inspected</th><th>Efficiency %</th><th>N/S °C</th><th>O/S °C</th></tr></thead>
        <tbody>
          <tr><td>52</td><td>71</td><td>Service Brake Performance</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
          <tr><td>53</td><td>72</td><td>Secondary Brake Performance</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
          <tr><td>54</td><td>73</td><td>Parking Brake Performance</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
        </tbody>
      </table>

      <div style="color:var(--accent); margin-top:8px; margin-bottom:6px">Axle RBT results</div>
      <table>
        <tbody>
          <tr><td style="width:30%"><strong>Imbalance (kg)</strong></td><td><input type="text"></td></tr>
          <tr><td><strong>Time Lag</strong></td><td><select id="timeLag"><option value="">-- Select --</option><option value="Pass">Pass</option><option value="Fail">Fail</option></select></td></tr>
          <tr><td><strong>Ovality (Front steer)</strong></td><td><input type="text"></td></tr>
          <tr><td><strong>Bind (kg)</strong></td><td><input type="text"></td></tr>
          <tr><td><strong>Max Force (kg)</strong></td><td><input type="text"></td></tr>
          <tr><td><strong>Parking (kg)</strong></td><td><input type="text"></td></tr>
          <tr><td><strong>Axle 1 - weight N/S / O/S</strong></td><td><input type="text" placeholder="N/S / O/S"></td></tr>
          <tr><td><strong>Axle 2 - weight N/S / O/S</strong></td><td><input type="text" placeholder="N/S / O/S"></td></tr>
          <tr><td><strong>Axle 3 - weight N/S / O/S</strong></td><td><input type="text" placeholder="N/S / O/S"></td></tr>
          <tr><td><strong>Axle 4 - weight N/S / O/S</strong></td><td><input type="text" placeholder="N/S / O/S"></td></tr>
          <tr><td><strong>EBPMS braking performance value</strong></td><td><input type="text"></td></tr>
          <tr><td><strong>Assessment period</strong></td><td><input type="text"></td></tr>
          <tr><td><strong>Overall Result</strong></td><td><select id="overallResult"><option value="">-- Select --</option><option value="Satisfactory">Satisfactory</option><option value="Unsatisfactory">Unsatisfactory</option></select></td></tr>
        </tbody>
      </table>

      <div style="margin-top:10px"><label class="small">Inspector comments</label><textarea id="inspector_comments"></textarea></div>

      <div class="section-title">Part 2 — Comments on faults found</div>
      <p class="small">Faults numbered here are Drivers Defect Report items (auto-populated)</p>
      <textarea id="faultsFound" placeholder="Auto-populated from any R or × selections (you can edit)"></textarea>

      <div style="margin-top:12px">
        <label class="small">Signature of inspector</label>
        <select id="inspector_signature"><option value="">-- Select --</option>
<option value="Tech 1 - Barry Baxter">Tech 1 - Barry Baxter</option>
<option value="Tech2 - TBC">Tech2 - TBC</option>
<option value="Tech3 - TBC">Tech3 - TBC</option>
<option value="OUTSOURCED">OUTSOURCED</option>
</select>
      </div>
      <div style="margin-top:8px"><label class="small">Name of inspector</label><select id="inspector_name"><option value="">-- Select --</option>
<option value="Tech 1 - Barry Baxter">Tech 1 - Barry Baxter</option>
<option value="Tech2 - TBC">Tech2 - TBC</option>
<option value="Tech3 - TBC">Tech3 - TBC</option>
<option value="OUTSOURCED">OUTSOURCED</option>
</select></div>

      <div class="pdf-page-break"></div>

      <div class="section-title">Part 3 — Action taken on faults found</div>
      <p class="small">Auto-populated Fault No column will match generated fault IDs. Add action details below.</p>
      <table id="actionsTable">
        <thead><tr><th style="width:9%">Chk No</th><th style="width:12%">Fault No</th><th>Action taken on fault</th><th style="width:20%">Rectified By</th></tr></thead>
        <tbody></tbody>
      </table>

      <div class="section-title">Part 4 — Declaration</div>
      <p class="small">“I consider that the above defects have been rectified satisfactorily and this vehicle or trailer is now in a safe and roadworthy condition.”</p>
      <table>
        <tbody>
          <tr><td style="width:26%"><strong>Defects rectified by</strong></td><td><select id="decl_rectified"><option value="">-- Select --</option>
<option value="Tech 1 - Barry Baxter">Tech 1 - Barry Baxter</option>
<option value="Tech2 - TBC">Tech2 - TBC</option>
<option value="Tech3 - TBC">Tech3 - TBC</option>
<option value="OUTSOURCED">OUTSOURCED</option>
</select></td></tr>
          <tr><td><strong>Position</strong></td><td><select id="decl_position">
<option value="GTT Vehicle Engineer">GTT Vehicle Engineer</option>
<option value="Outside Company">Outside Company</option>
<option value="Other Trained Person">Other Trained Person</option>
</select></td></tr>
          <tr><td><strong>Signature</strong></td><td><select id="decl_signature" class="italic-select"><option value="">-- Select --</option>
<option value="Tech 1 - Barry Baxter">Tech 1 - Barry Baxter</option>
<option value="Tech2 - TBC">Tech2 - TBC</option>
<option value="Tech3 - TBC">Tech3 - TBC</option>
<option value="OUTSOURCED">OUTSOURCED</option>
</select></td></tr>
          <tr><td><strong>Date</strong></td><td><input id="decl_date" type="date"></td></tr>
        </tbody>
      </table>

      <div class="muted-note">Form generated client-side. Click submit to download a multi-page PDF replica of this page.</div>
    </div>

    <button id="submitBtn" class="btn">Submit & Download PDF</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
/* ---------- Vehicle Data (Hardcoded from Book1.xlsx - Sheet1.csv) ---------- */
const vehicleData = {
  "AU67CVV": { "make": "Sprinter, 513 CDI", "vin": "WDB9066552P274254" },
  "AU67CVX": { "make": "Sprinter, 513 CDI", "vin": "WDB9066552P245671" },
  "AY66RXH": { "make": "Sprinter, 514CDI", "vin": "WDB9066572P311772" },
  "AY66RXJ": { "make": "Sprinter, 514CDI", "vin": "WDB9066572P311773" },
  "AY66RXK": { "make": "Sprinter, 514CDI", "vin": "WDB9066572P315712" },
  "AY66RXL": { "make": "Sprinter, 514CDI", "vin": "WDB9066572P312303" },
  "BX69CVJ": { "make": "Streetlite, Other", "vin": "SA9DSRXXX18141696" },
  "CN09GHJ": { "make": "Other, Other", "vin": "VF1NDD1L639874869" },
  "DV21VFZ": { "make": "2t Diesel Van, Other", "vin": "VXEVBYHRKM7821672" },
  "EA67XGS": { "make": "Transit, 460 H/R BUS 18 STR", "vin": "WF0HXXTTGHHR03237" },
  "EO16MHE": { "make": "Transit, Other", "vin": "WFWFOHXXTTGHFJ68905" },
  "EU68OKT": { "make": "Transit, 350", "vin": "WF0XXXTTGXJU36733" },
  "EY16ACU": { "make": "MERCEDES 616, Other", "vin": "WDB9066552P228789" },
  "EY16NHE": { "make": "Sprinter, 513 CDI", "vin": "" }, // VIN was empty in source
  "FN65PYY": { "make": "Other, Other", "vin": "WOLMTF8UKFB075084" },
  "FN65ZYT": { "make": "Focus, Other", "vin": "WF05XXGCC5FS31497" },
  "GX65FDN": { "make": "Sprinter, 516CDI", "vin": "WDB9066572P119209" },
  "KM19EFA": { "make": "Sprinter, 514 CDI", "vin": "WDB9066572P641520" },
  "KP21ONF": { "make": "Sprinter, 514 CDI", "vin": "W1V9076572P236365" },
  "KV69VYO": { "make": "Sprinter, 514 CDI", "vin": "WDB9076572P134360" },
  "KV70RHU": { "make": "Sprinter, 514CDI", "vin": "W1V9076572P206577" },
  "KX21RZH / 325206": { "make": "Sprinter, 514 CDI", "vin": "W1V9076572P240864" },
  "LK14EAF": { "make": "Sprinter, 513 CDI", "vin": "" }, // VIN was empty in source
  "LN18EWC": { "make": "Sprinter, 516CDI", "vin": "WDB9061552N736461" },
  "LN18EWD": { "make": "Sprinter, 516CDI", "vin": "WDB9061552N736460" },
  "LN18EWF": { "make": "Sprinter, 516CDI", "vin": "WDB9061552N736462" },
  "LT63VJP": { "make": "Sprinter, 513 CDI", "vin": "WDB9066552S831705" },
  "LV16HMZ": { "make": "Sprinter, 513 CDI XLWB", "vin": "WDB9066572P312297" },
  "LX66AFJ": { "make": "Sprinter, 514 CDI", "vin": "WDB9066572P312301" },
  "LX66AMV": { "make": "Sprinter, 513 CDI XLWB", "vin": "WDB9066572P312785" },
  "MX11CZJ": { "make": "Streetlite, Other", "vin": "SA9DSRXXX10141028" },
  "RO59HXV": { "make": "Other, Other", "vin": "VF1PDM1L642087925" },
  "RV67RCU": { "make": "Sprinter, 516CDI", "vin": "WDB9066572P533630" },
  "RX72TJV": { "make": "Sprinter, Other", "vin": "W1V9076572P435973" },
  "SB66RUH": { "make": "Other, Other", "vin": "WV2ZZZ2KZHX054709" },
  "SH16PVW": { "make": "Other, Other", "vin": "WV2ZZZ2KZGX110194" },
  "SK18TKN": { "make": "Streetlite, Other", "vin": "SA9DSRXXX16141325" },
  "SK18TKO": { "make": "Streetlite, Other", "vin": "SA9DSRXXX16141326" },
  "SK65PWV": { "make": "Streetlite, Other", "vin": "SA9DSRXXX14141661" },
  "SK68TMZ": { "make": "Streetlite, Other", "vin": "SA9DSRXXX16141264" },
  "SK68TNE": { "make": "Streetlite, Other", "vin": "SA9DSRXXX16141266" },
  "SN64FTX": { "make": "Other, Other", "vin": "" }, // VIN was empty in source
  "SN69ZVS": { "make": "Streetlite, Other", "vin": "SA9DSRXXX19141792" },
  "SP59TSU": { "make": "Sprinter, 413 CDI", "vin": "WDB9066552S434563" },
  "WG71MXN": { "make": "Acenta , Other", "vin": "" }, // VIN was empty in source
  "WR25OFV": { "make": "Sprinter, 516 CDI C/C BLUEEFFICIENCY LWB", "vin": "W1V5H33Z4N334069" },
  "YD66OUE": { "make": "Other, Other", "vin": "WDB9066572P297425" }
};
/* -------------------------------------------------------------------------- */

/* ---------- Utilities ---------- */
function getISOWeekNumber(d) {
  const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
  const dayNum = date.getUTCDay() || 7;
  date.setUTCDate(date.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(date.getUTCFullYear(),0,1));
  return Math.ceil((((date - yearStart) / 86400000) + 1)/7);
}
function pad(n, digits=3){ return String(n).padStart(digits,'0'); }
function generateJobNumber(){
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  const rnd = Math.floor(Math.random()*90000)+10000;
  return `${y}${m}${day}-${rnd}`;
}

/* ---------- Init page values and Vehicle Data Population ---------- */

// New function to populate the Reg Mark dropdown and handle auto-fill
function setupVehicleData() {
  const regMarkSelect = document.getElementById('reg_mark');
  const makeModelInput = document.getElementById('make_model');
  const vinInput = document.getElementById('vin');
  const regMarks = Object.keys(vehicleData).sort();

  // Populate the dropdown with options
  regMarks.forEach(reg => {
    const data = vehicleData[reg];
    const option = document.createElement('option');
    option.value = reg;
    option.textContent = reg;
    regMarkSelect.appendChild(option);
  });

  // Event listener to auto-populate Make/Model and VIN
  regMarkSelect.addEventListener('change', function() {
    const selectedReg = this.value;
    if (selectedReg && vehicleData[selectedReg]) {
      makeModelInput.value = vehicleData[selectedReg].make || '';
      vinInput.value = vehicleData[selectedReg].vin || '';
    } else {
      makeModelInput.value = '';
      vinInput.value = '';
    }
  });
}

const jobNum = generateJobNumber();
document.getElementById('jobNumber').textContent = jobNum;
document.getElementById('iso_week').value = getISOWeekNumber(new Date());
document.getElementById('inspection_date').addEventListener('change', function(){
  const d = this.value ? new Date(this.value) : new Date();
  document.getElementById('iso_week').value = getISOWeekNumber(d);
});

/* ---------- Fault tracking and UI behaviour (rest of original script) ---------- */
const RECTIFIED_OPTIONS = [
  { value: "Tech 1 - Barry Baxter", text: "Tech 1 - Barry Baxter" },
  { value: "Tech2 - TBC", text: "Tech2 - TBC" },
  { value: "Tech3 - TBC", text: "Tech3 - TBC" },
  { value: "OUTSOURCED", text: "OUTSOURCED" }
];
const colorMap = {'✓':'#6ee77a','×':'#ff7b7b','R':'#9fd8ff','N/A':'#cbd5e1','M':'#ffb86b'};
let faultCounter = 0;
const faultMap = {}; // rowId -> { id, check, item }

function generateFaultId(){ faultCounter++; return 'F' + pad(faultCounter,3); }

function styleServiceable(sel){
  const v = sel.value;
  sel.style.background = colorMap[v] || '#fff';
}

/* When a serviceable select changes */
function onServiceableChange(e){
  const sel = e.target;
  styleServiceable(sel);

  const row = sel.closest('tr');
  const rowId = row.getAttribute('data-check') || ('row-' + Array.from(document.querySelectorAll('tr')).indexOf(row));

  const val = sel.value;
  if(val === 'R' || val === '×'){
    if(!faultMap[rowId]){
      const id = generateFaultId();
      // Only capture check number and item description
      const checkNum = row.querySelector('td').innerText.trim();
      const itemDesc = row.querySelectorAll('td')[2].innerText.trim();
      
      faultMap[rowId] = { id: id, check: checkNum, item: itemDesc };
    }
  } else {
    if(faultMap[rowId]){
      delete faultMap[rowId];
    }
  }
  syncFaultsToFaultsFound();
  syncFaultsToActionsTable();
}

/* Hook up all existing serviceable selects */
document.querySelectorAll('.serviceable').forEach(s=>{
  styleServiceable(s);
  s.addEventListener('change', onServiceableChange);
});

/* Sync faultMap to Part 2 textarea */
function syncFaultsToFaultsFound(){
  const area = document.getElementById('faultsFound');
  const lines = [];
  Object.keys(faultMap).forEach(k=>{
    const f = faultMap[k];
    // Prompt the user to add the specific defect description in the textarea
    lines.push(`${f.id} — ${f.item} (Check No: ${f.check}) : [ADD DEFECT DETAILS HERE]`);
  });
  area.value = lines.join('\n\n');
}

/* Sync faultMap to Actions table */
function syncFaultsToActionsTable(){
  const tbody = document.querySelector('#actionsTable tbody');
  tbody.innerHTML = '';
  const keys = Object.keys(faultMap);
  const optionsHtml = RECTIFIED_OPTIONS.map(opt => `<option value="${opt.value}">${opt.text}</option>`).join('');

  if(keys.length === 0){
    // show one empty editable row
    const tr = document.createElement('tr');
    tr.innerHTML = `<td><input type="text" class="act_chk" /></td><td class="act_fault"></td><td><textarea class="act_action"></textarea></td><td><select class="rectified"><option value="">-- Select --</option>${optionsHtml}</select></td>`;
    tbody.appendChild(tr);
    return;
  }
  keys.forEach(k=>{
    const f = faultMap[k];
    const tr = document.createElement('tr');
    // f.check is now the item number, f.id is the fault ID
    tr.innerHTML = `<td><input type="text" class="act_chk" value="${f.check || ''}" /></td><td class="act_fault">${f.id}</td><td><textarea class="act_action"></textarea></td><td><select class="rectified"><option value="">-- Select --</option>${optionsHtml}</select></td>`;
    tbody.appendChild(tr);
  });
}

/* color overall result if unsatisfactory */
const overallSelect = document.getElementById('overallResult');
if (overallSelect) {
  overallSelect.addEventListener('change', function(){
    this.style.background = this.value === 'Unsatisfactory' ? '#ff7b7b' : '#fff';
  });
}

/* ensure serviceables styled for any dynamic changes */
document.addEventListener('change', function(e){
  if(e.target && e.target.classList && e.target.classList.contains('serviceable')){
    styleServiceable(e.target);
  }
});

/* ---------- PDF export using html2canvas to produce exact replica ---------- */
document.getElementById('submitBtn').addEventListener('click', async function(e){
  e.preventDefault();

  // ensure any pending UI changes are applied
  // collect filename parts
  const regRaw = (document.getElementById('reg_mark').value || 'NOREG').trim();
  const reg = regRaw ? regRaw.replace(/\s+/g,'') : 'NOREG';
  const job = jobNum;
  const inspDateVal = document.getElementById('inspection_date').value;
  const dateForFile = inspDateVal ? inspDateVal : new Date().toISOString().slice(0,10);

  // html2canvas render
  const formEl = document.getElementById('formPage');

  try {
    // Increase scale for sharper PDF text
    const canvas = await html2canvas(formEl, {scale: 2, useCORS: true, logging: false, backgroundColor: '#ffffff'});

    const imgData = canvas.toDataURL('image/png');

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p','mm','a4');
    const pdfW = pdf.internal.pageSize.getWidth();
    const pdfH = pdf.internal.pageSize.getHeight();
    const margin = 8; // mm
    const usableW = pdfW - margin*2;

    // calculate rendered image size in PDF mm
    const imgWidth = usableW;
    const imgHeight = (canvas.height * imgWidth) / canvas.width;

    // How many pages needed?
    let remainingHeight = imgHeight;
    let positionY = 0;

    // Add first page
    pdf.addImage(imgData, 'PNG', margin, margin + positionY, imgWidth, imgHeight);
    remainingHeight -= (pdfH - margin*2);

    // Add further pages if needed
    while(remainingHeight > 0){
      pdf.addPage();
      positionY = imgHeight - remainingHeight;
      // negative y to shift the image up so correct slice shows on next page
      const drawY = margin - positionY;
      pdf.addImage(imgData, 'PNG', margin, drawY, imgWidth, imgHeight);
      remainingHeight -= (pdfH - margin*2);
    }

    const filename = `${reg}_${job}_${dateForFile}.pdf`;
    pdf.save(filename);
  } catch(err){
    console.error('PDF generation failed', err);
    alert('PDF generation failed — see console for details. Common causes: remote images blocked by CORS. Try hosting logos locally or allow CORS on the logo host.');
  }
});

/* Initialize actions table and faults area on load */
(function init(){
  setupVehicleData(); // Call the new setup function
  syncFaultsToActionsTable();
})();
</script>
</body>
</html>